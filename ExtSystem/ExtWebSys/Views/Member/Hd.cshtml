@{
    ViewBag.Title = "Index";


    ViewBag.Index = "00";
    Layout = "~/Views/Shared/_LayoutNMember.cshtml";

    
    
    

}

@model NModel.NewsPager
@{
    
    
  var UserInfo=  Model.IDictUserModel["当前用户信息"];
}
<link href="/content/imgareaselect/css/imgareaselect-animated.css" rel="stylesheet" />




<script src="/content/imgareaselect/scripts/jquery.imgareaselect.pack.js"></script>







<div class="cmcenter">
    <div class="cmheader">
        <div class="cmheadermsg"><a href="#">个人信息管理</a> » <a> 修改登录密码</a></div>
        <div class="clear" style="height:15px;"></div>


        @*<div class="cmheader">


                <span class="cmspan">
                    <div class="cmheadersearch">

                        <input type="text" class="cmheadertxtsearch" style="border:1px solid #d9d9d9;height:28px;width:250px;line-height:28px" />
                        <input type="button" value="搜索" style="border:1px solid #d9d9d9;width:50px; height:28px" />

                    </div>



                    <div class="cmheaderbtn">
                        <input type="button" value="清除所有消息" style="border: 1px solid #38A4E0; width: 100px; height: 28px; float: right; margin-left: 10px; " />
                        <input type="button" value="发送消息" style="border: 1px solid #38A4E0; width: 100px; height: 28px; float: right; " />

                    </div>

                </span>
            </div>*@



    </div>

    <div class="clear"></div>
    <div class="cmheadercn">








        <div class="cmheadertop">


            <h2 class="cmheaderh2">更改头像图片</h2>

        </div>

        <div class="clear" style="height:5px;"></div>
        <form>

            <div class="container demo">
                <div style="float: left; width: 50%;">
               

                    <div class="frame" style="margin: 0 0.3em; ">
                        <img id="photo" src="/upload/flower2.jpg" style="display:none;" />
                    </div>
                </div>

                <div style="float: left; width: 50%;">
                    <p  class="previewtitle">
                        浏览图片
                    </p>

                    <div class="frame"
                         style=" width: 120px; height: 120px;">
                        <div id="preview" style="width: 120px; height: 120px; overflow: hidden;">
                            <img class="pmini" src="/upload/flower2.jpg" style="display:none;" />
                        </div>
                    </div>

                    <div class="clear" style="height:10px;"></div>
                    <table>
                        <tr>
                            <th align="left" style="color:#666;"> 用户头像</th>

                        </tr>
                        <tr><td>

                                <div style="border:1px solid #d9d9d9;width:120px; height:120px;">

                                     @{
                                         
                                         
                                         if(!string.IsNullOrEmpty(user.User_HeadImg)){
                                        
                                          <img src="@(user.User_HeadImg)" id="showimg"  />
                                            
                                            
                                        
                                        }else
                                         {
                                         
                                           <img src="" id="showimg" style="display:none;" />
                                         
                                         }}
                                  

                                </div>

                            <div class="clear" style="height:10px;"></div>
                                <div>
                                    <div onclick="uploadCut()" class="btnblue headbtn">
                                        保存头像

                                    </div>
                                  

                                </div>
                            
                            </td></tr>

                    </table>

                    <table style="margin-top: 1em;display:none;" >
                        <thead>
                            <tr>
                                <th colspan="2" style="font-size: 110%; font-weight: bold; text-align: left; padding-left: 0.1em;">
                                    Coordinates
                                </th>
                                <th colspan="2" style="font-size: 110%; font-weight: bold; text-align: left; padding-left: 0.1em;">
                                    Dimensions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="width: 10%;"><b>X<sub>1</sub>:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" id="x1" value="-" />
                                </td>
                                <td style="width: 20%;"><b>Width:</b></td>
                                <td>
                                    <input type="text" value="-" id="w" />
                                </td>
                            </tr>
                            <tr>
                                <td><b>Y<sub>1</sub>:</b></td>
                                <td>
                                    <input type="text" id="y1" value="-" />
                                </td>
                                <td><b>Height:</b></td>
                                <td>
                                    <input type="text" id="h" value="-" />
                                </td>
                            </tr>
                            <tr>
                                <td><b>X<sub>2</sub>:</b></td>
                                <td>
                                    <input type="text" id="x2" value="-" />
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><b>Y<sub>2</sub>:</b></td>
                                <td>
                                    <input type="text" id="y2" value="-" />
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <div style="clear:both;"></div>
            <div id="filelist" style="display:none;">Y</div>
            <br />
            <div id="container">
                <div  id="pickfiles"  class="btnblue headbtn">
                    选择图片
                
                </div>
                <div id="uploadfiles" class="btnblue headbtn">
                    上传图片
                </div>
            </div>

            <div class="clear"></div>
            <br />
<pre id="console"></pre>

            <script src="~/Content/plupload/js/plupload.full.min.js"></script>
            
            <script type="text/javascript">
                // Custom example logic

                var uploader = new plupload.Uploader({
                    runtimes: 'html5,flash,silverlight,html4',
                    browse_button: 'pickfiles', // you can pass in id...
                    container: document.getElementById('container'), // ... or DOM Element itself
                    url: '/UploadFile/UploadHead',

                    flash_swf_url: '/Content/plupload/js/Moxie.swf',
                    silverlight_xap_url: '/Content/plupload/js/Moxie.xap',
                    multi_selection:false,
                    filters: {
                        max_file_size: '10mb',
                        mime_types: [
                            { title: "Image files", extensions: "jpg,gif,png" },
                            { title: "Zip files", extensions: "zip" }
                        ]
                    },

                    init: {
                        PostInit: function () {


                            // uploader.settings.url = uploader.settings.url + '?token=' + myToken;
                            document.getElementById('filelist').innerHTML = '';

                            document.getElementById('uploadfiles').onclick = function () {
                                uploader.start();
                                return false;
                            };
                        },

                        FilesAdded: function (up, files) {
                            plupload.each(files, function (file) {


                                document.getElementById('filelist').innerHTML += '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
                            });
                        },

                        UploadProgress: function (up, file) {
                            document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
                        },

                        Error: function (up, err) {
                            document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
                        },
                        FileUploaded: function (up, file, info) {
                            // Called when file has finished uploading
                            var img = info["response"];
                            $(".pmini").show();
                            $('#photo').show();
                            $("#showimg").show();
                            $('#preview img').attr("src", "/upload/" + img)
                            $('#photo').attr("src", "/upload/" + img)
                            $('#photo').attr("path", img);


                        }

                    }
                });

                uploader.init();

            </script>
            <script type="text/javascript">
                function preview(img, selection) {
                    if (!selection.width || !selection.height)
                        return;

                    var scaleX = 120/ selection.width;
                    var scaleY = 120/ selection.height;

                    $('#preview img').css({
                        width: Math.round(scaleX * 405),
                        height: Math.round(scaleY * 344),
                        marginLeft: -Math.round(scaleX * selection.x1),
                        marginTop: -Math.round(scaleY * selection.y1)
                    });

                    $('#x1').val(selection.x1);
                    $('#y1').val(selection.y1);
                    $('#x2').val(selection.x2);
                    $('#y2').val(selection.y2);
                    $('#w').val(selection.width);
                    $('#h').val(selection.height);
                }

                $(function () {
                    $('#photo').imgAreaSelect({
                        x1: 125, y1: 94, x2: 242, y2: 211,minWidth:60, minHeight:60,maxWidth: 120, maxHeight: 120,
                        aspectRatio: '1:1', handles: true,
                        fadeSpeed: 200, onSelectChange: preview
                    });
                });
                function uploadCut() {


                    var x1 = $('#x1').val();
                    var y1 = $('#y1').val();
                    var x2 = $('#x2').val();
                    var y2 = $('#y2').val();
                    var _w = $('#w').val();
                    var _h = $('#h').val();
                    var _img = $('#photo').attr("path");
                    $.post("/UploadFile/UploadHeadCut?cid=10034", { x: x1, y: y1, w: _w, h: _h, img: _img }, function (dt) {
                        if (dt != null) {
                            $("#showimg").attr("src", dt);
                            $("#showimg").show();

                        }
                    })

                }

            </script>

        </form>
        <div class="clear"></div>
    </div>
    <div class="clear" style="height:15px;"></div>


</div>

